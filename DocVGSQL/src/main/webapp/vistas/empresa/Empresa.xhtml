<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Registro de Empresas</title>
    </h:head>
    <h:body>
        <!--IDEMP RAZEMP     COMEMP  RUCEMP ESTEMP DIREMP CODUBI TELEMP-->

        <center>
            <p:growl id="msgs" showDetail="true" life="1000"/>
            <h:form id="formIns">              

                <h1 style="margin-top:0">Registrar Empresa</h1>
                <p:panelGrid columns="4">
                    <p:outputLabel value="Razon Social"/>
                    <p:inputText value="#{empresaC.emp.RAZEMP}" maxlength="50" required="true" requiredMessage="Se reqiuere la razon social">
                        <p:keyFilter regEx="/[A-Z_a-z_ñ _á_é_í_ó_ú]/"/>
                    </p:inputText>
                    <p:outputLabel value="Razon Comercial"/>
                    <p:inputText value="#{empresaC.emp.COMEMP}" maxlength="50">
                        <p:keyFilter regEx="/[A-Z_a-z_ñ _á_é_í_ó_ú]/"/>
                    </p:inputText>
                    <p:outputLabel value="Direccion"/>
                    <p:inputText value="#{empresaC.emp.DIREMP}" maxlength="50">
                    </p:inputText>
                    <p:outputLabel value="RUC"/>
                    <p:inputText value="#{empresaC.emp.RUCEMP}" maxlength="11" required="true" requiredMessage="Se reqiuere el ruc">
                        <p:keyFilter regEx="/[0-9]/"/>
                    </p:inputText>
                    <p:outputLabel value="Distrito"  />
                    <p:autoComplete  value="#{empresaC.emp.CODUBI}" completeMethod="#{empresaC.listarUbigeo}" />
                    <p:outputLabel value="Teléfono" />
                    <p:inputText value="#{empresaC.emp.TELEMP}" maxlength="20">
                        <p:keyFilter regEx="/[0-9]/"/>
                    </p:inputText>
                </p:panelGrid>

                <h:panelGrid columns="2" cellpadding="5" > 
                    <h:outputLabel for="multiple" value="Responsable(s):" />
                    <p:selectCheckboxMenu id="multiple" value="#{empresaC.selectedResp}" label="Responsables" multiple="true"
                                          filter="true" filterMatchMode="startsWith" panelStyle="width:400px" widgetVar="var">
                        <f:selectItems value="#{empresaC.responsables}" />
                    </p:selectCheckboxMenu>  
                </h:panelGrid>
                <p:commandButton value="Agignar" actionListener="#{empresaC.registrar()}" update="formIns :frmTable"/> 
                <p:commandButton value="Limpiar" actionListener="#{empresaC.limpiar()}" update="formIns" /> 
                <p:commandButton value="Ver Selección" update="displayItems" actionListener="#{empresaC.verEscogidos()}" oncomplete="PF('itemDialog').show()" style="margin-top:10px;" />

                <p:dialog header="Items Seleccionados" modal="true" showEffect="fade" hideEffect="fade" widgetVar="itemDialog" width="450">
                    <p:outputPanel id="displayItems">
                        <p:dataList value="#{empresaC.selectedResp}" var="respon" emptyMessage="No se seleccionó a nadie" style="margin-bottom: 10px;">
                            <f:facet name="header">
                                Multiple
                            </f:facet>
                            #{respon}
                        </p:dataList>
                    </p:outputPanel>
                </p:dialog>
                <p />
            </h:form>
            <h:form id="frmTable">
                <p:dataTable var="lista" 
                             value="#{empresaC.listadoEmp}"                          
                             id="dtTable"
                             selectionMode="single"
                             selection="#{empresaC.select}" rowKey="#{lista.IDEMP}" 
                             scrollable="true" scrollHeight="150" >
                    <f:facet name="header">
                        EMPRESAS
                    </f:facet>
                    <p:ajax event="rowSelect" update="frmTable :formDetails" listener="#{empresaC.listadoRespxEmp()}" />    

                    <p:column headerText="RUC" filterBy="#{lista.RUCEMP}" filterMatchMode="contains" style="width: 110px">
                        <center>
                            <h:outputText value="#{lista.RUCEMP}" />
                        </center>
                    </p:column>
                    <p:column headerText="Razon Social"  filterBy="#{lista.RAZEMP}" filterMatchMode="contains">
                        <center>
                            <h:outputText value="#{lista.RAZEMP}" />
                        </center>
                    </p:column>
                    <p:column headerText="Razón Comercial" >
                        <center>
                            <h:outputText value="#{lista.COMEMP}" />
                        </center>
                    </p:column>
                    <p:column headerText="Direccion" >
                        <h:outputText value="#{lista.DIREMP}" />
                    </p:column>
                    <p:column headerText="Distrito" >
                        <h:outputText value="#{lista.CODUBI}" />
                    </p:column>
                    <p:column headerText="Teléfono" >
                        <center>
                            <h:outputText value="#{lista.TELEMP}" />
                        </center>
                    </p:column>
                </p:dataTable>  

            </h:form>

            <h:form id="formDetails">
                <p:dataTable value="#{empresaC.persxEmp}" var="resp">
                    <f:facet name="header">
                        Responsable(s) 
                    </f:facet>
                    <p:column headerText="Nombre">
                        <h:outputText value="#{resp.NOMPER}" />
                    </p:column>
                    <p:column headerText="Cargo">
                        <h:outputText value="#{resp.CARPER}" />
                    </p:column>
                    <p:column headerText="Estado">
                        <h:outputText value="#{resp.ESTASI}" />
                    </p:column>
                    <p:column headerText="Fecha Asignación">
                        <h:outputText value="#{resp.FECASI}" />
                    </p:column>
                </p:dataTable>
            </h:form>
        </center>  
    </h:body>
</html>

